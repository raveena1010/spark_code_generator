from pyspark.sql import SparkSession
spark = SparkSession.builder.appName("SparkApp").master("local[5]").getOrCreate()
from pyspark.sql.functions import col
from pyspark.sql.functions import expr
from pyspark.sql.functions import when
StockPrice = spark.read.option('header',True).option('delimiter',',').option('inferSchema',True).csv('ln')
Stockcompanies = spark.read.option('header',True).option('delimiter',',').option('inferSchema',True).csv('df')
StockPrice = StockPrice.withColumn("newdate",col("date"))
StockPrice.registerTempTable("df")
StockPrice = spark.sql("select newdate, symbol, open,close from df")
Stockcompanies = Stockcompanies.withColumn("Headquarter",expr("upper(Headquarter)"))
StockPrice_Stockcompanies_join = StockPrice.alias('left').join(Stockcompanies.alias('right'),[col('left.symbol')==col('right.Ticker_symbol')],'inner').drop(Stockcompanies.Ticker_symbol)
StockPrice_Stockcompanies_join.registerTempTable("df")
StockPrice_Stockcompanies_join = spark.sql("select * , sha2(symbol,256) as masked_symbol from df")
StockPrice_Stockcompanies_join.write.mode('overwrite').option('header',True).option('delimiter',',').option('inferschema',True).csv('output_13')
